generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                 @id @default(uuid())
  email                String                 @unique
  password             String
  firstName            String
  lastName             String
  role                 UserRole               @default(ADMIN)
  isActive             Boolean                @default(true)
  assignedAdminId      String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  activityLogs         ActivityLog[]
  completedProcessData CompletedProcessData[] @relation("CompletedByUser")
  pushedDataFinal      DataFinal[]            @relation("PushedByUser")
  reachedDataFinal     DataFinal[]            @relation("ReachedByUser")
  assignedTasks        DataUploadTask[]       @relation("AssignedAdmin")
  uploadedTasks        DataUploadTask[]       @relation("UploadedBy")
  twoFactorAuth        TwoFactorAuth?
  assignedAdmin        User?                  @relation("ContributorAdmin", fields: [assignedAdminId], references: [id])
  contributors         User[]                 @relation("ContributorAdmin")

  @@map("users")
}

model TwoFactorAuth {
  id          String   @id @default(uuid())
  userId      String   @unique
  secret      String
  backupCodes String   @db.LongText
  isEnabled   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("two_factor_auth")
}

model DataUploadTask {
  id               String          @id @default(uuid())
  status           TaskStatus      @default(PENDING)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  assignedTo       String?
  createdBy        String
  duplicateRecords Int             @default(0)
  fileName         String
  invalidRecords   Int
  notes            String?
  processedRecords Int             @default(0)
  pushedRecords    Int             @default(0)
  totalRecords     Int
  uploadedAt       DateTime        @default(now())
  validRecords     Int
  dataInProcess    DataInProcess[]
  assignedToUser   User?           @relation("AssignedAdmin", fields: [assignedTo], references: [id])
  createdByUser    User            @relation("UploadedBy", fields: [createdBy], references: [id])

  @@index([assignedTo])
  @@index([createdBy])
  @@index([status])
  @@map("data_upload_tasks")
}

model DataInProcess {
  id                 String         @id @default(uuid())
  publisherEmail     String?
  publisherName      String?
  category           String?
  country            String?
  language           String?
  tat                String?
  status             ProcessStatus  @default(PENDING)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  daRange            String?
  linkType           String?
  notes              String?
  price              Float?
  publisherContact   String?
  uploadTaskId       String
  websiteUrl         String
  da                 Int?
  dr                 Int?
  reachedAt          DateTime?
  reachedBy          String?
  ss                 Int?
  traffic            Int?
  lastModifiedBy     String?
  lastModifiedByName String?
  reachedByName      String?
  gbBasePrice        Float?
  liBasePrice        Float?
  contactEmail       String?
  contactName        String?
  publisherId        String?
  publisherMatched   Boolean        @default(false)
  comment            String?
  keywords           Int?
  uploadedBy         String?
  uploadTask         DataUploadTask @relation(fields: [uploadTaskId], references: [id], onDelete: Cascade)

  @@index([uploadTaskId])
  @@index([status])
  @@index([websiteUrl])
  @@map("data_in_process")
}

model DataFinal {
  id                 String            @id @default(uuid())
  publisherName      String?
  publisherEmail     String?
  category           String?
  country            String?
  language           String?
  tat                String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  daRange            String?
  linkType           String?
  mainProjectId      String?
  notes              String?
  publisherContact   String?
  pushedAt           DateTime?
  pushedBy           String?
  websiteUrl         String
  da                 Int?
  dr                 Int?
  gbBasePrice        Float?
  liBasePrice        Float?
  negotiationStatus  NegotiationStatus @default(IN_PROGRESS)
  reachedAt          DateTime?
  reachedBy          String?
  ss                 Int?
  status             SiteStatus        @default(ACTIVE)
  traffic            Int?
  lastModifiedBy     String?
  lastModifiedByName String?
  reachedByName      String?
  contactEmail       String?
  contactName        String?
  publisherId        String?
  publisherMatched   Boolean           @default(false)
  keywords           Int?
  uploadedBy         String?
  pushedByUser       User?             @relation("PushedByUser", fields: [pushedBy], references: [id])
  reachedByUser      User?             @relation("ReachedByUser", fields: [reachedBy], references: [id])

  @@index([mainProjectId])
  @@index([pushedBy])
  @@index([reachedBy])
  @@index([websiteUrl])
  @@index([status])
  @@index([negotiationStatus])
  @@map("data_final")
}

model CompletedProcessData {
  id                String    @id @default(uuid())
  publisherName     String?
  category          String?
  country           String?
  language          String?
  tat               String?
  mainProjectId     String?
  createdAt         DateTime  @default(now())
  completedAt       DateTime?
  completedBy       String?
  daRange           String?
  linkType          String?
  notes             String?
  publisherContact  String?
  publisherEmail    String?
  updatedAt         DateTime  @updatedAt
  websiteUrl        String
  da                Int?
  dr                Int?
  gbBasePrice       Float?
  liBasePrice       Float?
  negotiationStatus String?
  ss                Int?
  status            String?
  traffic           Int?
  contactEmail      String?
  contactName       String?
  publisherId       String?
  publisherMatched  Boolean   @default(false)
  keywords          Int?
  completedByUser   User?     @relation("CompletedByUser", fields: [completedBy], references: [id])

  @@index([mainProjectId])
  @@index([completedBy])
  @@index([websiteUrl])
  @@map("completed_process_data")
}

model ActivityLog {
  id         String   @id @default(uuid())
  userId     String
  action     String
  entityType String
  entityId   String?
  details    String?  @db.LongText
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
  @@map("activity_logs")
}

enum UserRole {
  ADMIN
  SUPER_ADMIN
  USER
  CONTRIBUTOR
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum ProcessStatus {
  PENDING
  REACHED
  NOT_REACHED
  NO_ACTION
  NO_ACTION_NEEDED
  VERIFIED
  REJECTED
  PUSHED
}

enum SiteStatus {
  ACTIVE
  INACTIVE
}

enum NegotiationStatus {
  IN_PROGRESS
  DONE
}
